"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[681],{939:(e,n,s)=>{s.d(n,{RP:()=>o,xA:()=>l});var r=s(2155);const i=r.createContext({});function o(e){const n=r.useContext(i);return r.useMemo(()=>"function"==typeof e?e(n):{...n,...e},[n,e])}const t={};function l({components:e,children:n,disableParentContext:s}){let l;return l=s?"function"==typeof e?e({}):e||t:o(e),r.createElement(i.Provider,{value:l},n)}},4755:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>g,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"server/plugins","title":"Plugins","description":"Plugins enable optional integrations (e.g., storage, payments). They are declared via configuration and resolved at runtime with options.","source":"@site/docs/server/plugins.md","sourceDirName":"server","slug":"/server/plugins","permalink":"/storeways/docs/server/plugins","draft":false,"unlisted":false,"editUrl":"https://github.com/SufiyaanRajput/storeways/edit/main/repos/docs/docs/server/plugins.md","tags":[],"version":"current","frontMatter":{"id":"plugins","title":"Plugins"},"sidebar":"tutorialSidebar","previous":{"title":"Server (API)","permalink":"/storeways/docs/server"},"next":{"title":"API Reference","permalink":"/storeways/docs/server/api-reference"}}');var i=s(5723),o=s(939);const t={id:"plugins",title:"Plugins"},l=void 0,a={},c=[{value:"How to add a plugin (example: storage)",id:"how-to-add-a-plugin-example-storage",level:2},{value:"Using FileStorage in your code",id:"using-filestorage-in-your-code",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.RP)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Plugins enable optional integrations (e.g., storage, payments). They are declared via configuration and resolved at runtime with options."}),"\n",(0,i.jsx)(n.h2,{id:"how-to-add-a-plugin-example-storage",children:"How to add a plugin (example: storage)"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Implement the plugin"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Export a constructor that accepts ",(0,i.jsx)(n.code,{children:"options"})," and provides methods the app expects (e.g., ",(0,i.jsx)(n.code,{children:"upload"}),", ",(0,i.jsx)(n.code,{children:"delete"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Reference implementation: ",(0,i.jsx)(n.code,{children:"repos/server/src/plugins/storage/LocalFileStorage.js"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example (simplified):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'// repos/server/src/plugins/storage/LocalFileStorage.js\nimport config from "../../config";\n\nLocalFileStorage.prototype.upload = async function(fileBuffer, filename) {\n  // logic goes here\n}\n\nLocalFileStorage.prototype.delete = async function(filename) {\n  // logic goes here\n}\n\nfunction LocalFileStorage(options = {}) {\n  this.name = "storage-local";\n  this.options = options;\n}\n\nexport default LocalFileStorage;\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Register the plugin in server config"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add an entry in ",(0,i.jsx)(n.code,{children:"repos/server/config.js"})," under the ",(0,i.jsx)(n.code,{children:"plugins"})," array:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"key"}),": a unique identifier (e.g., ",(0,i.jsx)(n.code,{children:"storage"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"resolve"}),": path to your plugin module"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"options"}),": configuration passed to the plugin constructor (e.g., ",(0,i.jsx)(n.code,{children:"uploadDir"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// repos/server/config.js\nconst getConfig = () => ({\n  plugins: [\n    {\n      key: 'storage',\n      resolve: `./storage/LocalFileStorage`,\n      options: {\n        uploadDir: \"uploads\",\n      },\n    },\n  ],\n});\nexport default getConfig;\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Use via the adapter (not directly)"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"FileStorage"})," adapter resolves the plugin by key and forwards calls:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Adapter: ",(0,i.jsx)(n.code,{children:"repos/server/src/services/integrations/FileStorage.js"})]}),"\n",(0,i.jsx)(n.li,{children:"This keeps app code stable while allowing you to swap implementations."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example usage:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// repos/server/src/services/integrations/FileStorage.js\nimport getConfig from \"../../../config\";\nimport { getPlugin } from \"../../plugins/registry\";\n\nlet storage = null;\n\nconst getStorage = () => {\n  if (!storage) {\n    const pluginConfig = getConfig().plugins.find(p => p.key === 'storage');\n    const UploadService = getPlugin('storage');\n    storage = new UploadService(pluginConfig.options);\n  }\n  return storage;\n}\n\nFileStorage.prototype.upload = async function(...args) {\n  return getStorage().upload(...args);\n};\n\nFileStorage.prototype.delete = async function(...args) {\n  return getStorage().delete?.(...args);\n};\n\nfunction FileStorage() {}\nexport default FileStorage;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"using-filestorage-in-your-code",children:"Using FileStorage in your code"}),"\n",(0,i.jsx)(n.p,{children:"Service example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// repos/server/src/services/admin/updateProduct.js\nimport FileStorage from '../integrations/FileStorage';\n\nexport const addImage = async ({ file, fileName, ext }) => {\n  const storage = new FileStorage();\n  const { url, fileId } = await storage.upload(file, `${fileName}.${ext}`);\n  return {\n    url,\n    fileId,\n    name: fileName,\n  };\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Keep plugin APIs minimal and cohesive."}),"\n",(0,i.jsxs)(n.li,{children:["Use environment variables for secrets in ",(0,i.jsx)(n.code,{children:"options"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Prefer pure IO boundaries to make testing easier."}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,o.RP)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);